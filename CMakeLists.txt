cmake_minimum_required(VERSION 3.4)

project(LB::events-superproject
	LANGUAGES NONE
)

include(ExternalProject)
ExternalProject_Add(cloning
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/cloning"
	BUILD_ALWAYS 1
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}"
		${LB_CLONING_ARGS}
	TEST_EXCLUDE_FROM_MAIN 1
)
ExternalProject_Add(tuples
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/tuples"
	BUILD_ALWAYS 1
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}"
		${LB_TUPLES_ARGS}
	TEST_EXCLUDE_FROM_MAIN 1
)
ExternalProject_Add(events
	DEPENDS
		cloning
		tuples
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/events"
	BUILD_ALWAYS 1
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}"
		"-DCMAKE_MODULE_PATH=${CMAKE_CURRENT_SOURCE_DIR}/cloning/cmake#${CMAKE_CURRENT_SOURCE_DIR}/tuples/cmake"
		${LB_EVENTS_ARGS}
	TEST_BEFORE_INSTALL 1
	TEST_COMMAND ctest --output-on-failure
)