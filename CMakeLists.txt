cmake_minimum_required(VERSION 3.4)

project(LB::events-superproject
	LANGUAGES NONE
)

include(ExternalProject)
set(DEPS_INSTALL_DIR "${CMAKE_CURRENT_BINARY_DIR}/deps-install")
ExternalProject_Add(cloning
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/cloning"
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${DEPS_INSTALL_DIR}"
	TEST_EXCLUDE_FROM_MAIN 1
)
ExternalProject_Add(tuples
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/tuples"
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${DEPS_INSTALL_DIR}"
	TEST_EXCLUDE_FROM_MAIN 1
)
ExternalProject_Add(events
	DEPENDS
		cloning
		tuples
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/events"
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${DEPS_INSTALL_DIR}"
	TEST_AFTER_INSTALL 1
	TEST_COMMAND ctest --output-on-failure
)